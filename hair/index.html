<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¯¸ìš©ì‹¤ ë¦¬ë·° ì´¬ì˜</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    #videoPreview, #canvas, #downloadBtn, #reviewBtn { display: none; margin-top: 1em; }
    video { width: 100%; max-width: 400px; border: 1px solid #ccc; }
    canvas { display: none; }
    button, input[type="file"] { padding: 1em; font-size: 1em; }
  </style>
</head>
<body>
  <h1>ì§€ê¸ˆì˜ ë¨¸ë¦¬ê°€ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ë¨¸ë¦¬ì…ë‹ˆë‹¤.</h1>
  <h2>ì•„ë˜ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì§€ê¸ˆì˜ ë¨¸ë¦¬ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”.</h2>
  <div id="androidFlow">
    <input type="file" accept="image/*" capture="environment" id="androidInput">
  </div>

  <div id="iosFlow">
    <video id="videoPreview" autoplay playsinline></video>
    <button id="captureBtn">ì‚¬ì§„ ì°ê¸°</button>
    <canvas id="canvas"></canvas>
    <button id="downloadBtn">ì‚¬ì§„ ì €ì¥í•˜ê¸°</button>
  </div>

  <button id="reviewBtn">ğŸ‘‰ ë¦¬ë·° ì“°ëŸ¬ê°€ê¸°</button>

  <script>
    function isIOS() {
      return /iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    function isAndroid() {
      return /Android/i.test(navigator.userAgent);
    }

    const androidFlow = document.getElementById("androidFlow");
    const iosFlow = document.getElementById("iosFlow");
    const video = document.getElementById("videoPreview");
    const canvas = document.getElementById("canvas");
    const captureBtn = document.getElementById("captureBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const reviewBtn = document.getElementById("reviewBtn");

    if (isIOS()) {
      androidFlow.style.display = "none";
      iosFlow.style.display = "block";
      video.style.display = "block";

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
        })
        .catch(err => {
          alert("ì¹´ë©”ë¼ ì ‘ê·¼ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        });

      captureBtn.onclick = () => {
        const ctx = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        canvas.style.display = "block";
        downloadBtn.style.display = "inline-block";
      };

      downloadBtn.onclick = () => {
        const link = document.createElement('a');
        link.download = 'review_photo.jpg';
        link.href = canvas.toDataURL('image/jpeg');
        link.click();
        reviewBtn.style.display = "inline-block";
      };

    } else if (isAndroid()) {
      androidFlow.style.display = "block";
      iosFlow.style.display = "none";

      const androidInput = document.getElementById("androidInput");
      androidInput.onchange = () => {
        if (androidInput.files.length > 0) {
          alert("ì‚¬ì§„ì´ ì—…ë¡œë“œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!");
          reviewBtn.style.display = "inline-block";
        }
      };

    } else {
      alert("ì´ ê¸°ê¸°ëŠ” ì§€ì›ë˜ì§€ ì•Šê±°ë‚˜ ê°ì§€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    reviewBtn.onclick = () => {
      // ì—¬ê¸°ì— ë¦¬ë·° ë§í¬ ì‚½ì…
      window.open("https://m.place.naver.com/my/checkin", "_blank");
    };
  </script>
</body>
</html>