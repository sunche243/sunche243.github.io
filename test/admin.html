<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR 주문 관리</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .order {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 15px;
      background-color: white;
    }
    .completed {
      background-color: #d4edda;
      border-color: #28a745;
    }
    button {
      margin-right: 8px;
      margin-top: 6px;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import {
      getFirestore, collection, query, orderBy, onSnapshot,
      doc, updateDoc, deleteDoc
    } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC4p0c57uJHLj2un5W2Mr5Us0U8zw-4WzU",
      authDomain: "accounting-pub.firebaseapp.com",
      projectId: "accounting-pub"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const ordersDiv = document.getElementById("orders");

    const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));
    onSnapshot(q, (snapshot) => {
      ordersDiv.innerHTML = '';
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const orderId = docSnap.id;
        const div = document.createElement('div');
        div.className = 'order' + (data.completed ? ' completed' : '');
        const completeText = data.completed ? '확인 취소' : '확인';

        div.innerHTML = `
          <p><strong>테이블 ${data.table}</strong> | 입금자: ${data.name}</p>
          <p>주문: ${data.items.join(', ')}</p>
          <small>${data.timestamp}</small><br>
          <button class="toggle-btn">${completeText}</button>
          <button class="delete-btn">삭제</button>
        `;

        div.querySelector('.toggle-btn').addEventListener('click', async () => {
          const newStatus = !data.completed;
          await updateDoc(doc(db, 'orders', orderId), { completed: newStatus });
        });

        div.querySelector('.delete-btn').addEventListener('click', async () => {
          if (confirm('정말로 삭제하시겠습니까?')) {
            await deleteDoc(doc(db, 'orders', orderId));
          }
        });

        ordersDiv.appendChild(div);
      });
    });
  </script>
</head>
<body>
  <h2>주문 목록</h2>
  <div id="orders"></div>
</body>
</html>