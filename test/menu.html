<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR 주문</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .section { margin-bottom: 20px; }
    label { display: block; margin: 6px 0; }
    input[type="text"] { width: 100%; padding: 8px; }
    button { padding: 10px; width: 100%; font-size: 16px; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC4p0c57uJHLj2un5W2Mr5Us0U8zw-4WzU",
      authDomain: "accounting-pub.firebaseapp.com",
      projectId: "accounting-pub"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.addEventListener('DOMContentLoaded', () => {
      const table = new URLSearchParams(window.location.search).get('table') || 'unknown';
      document.getElementById('orderForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('payerName').value.trim();
        const items = Array.from(document.querySelectorAll('input[name="menu"]:checked')).map(el => el.value);

        if (!name || items.length === 0) {
          alert("입금자명과 메뉴를 모두 입력하세요.");
          return;
        }

        await addDoc(collection(db, 'orders'), {
          table, name, items, timestamp: new Date().toISOString(), completed: false
        });

        const query = new URLSearchParams({ table, name, items: items.join(', ') }).toString();
        window.location.href = `thankyou.html?${query}`;
      });
    });
  </script>
</head>
<body>
  <h2>QR 주문</h2>
  <form id="orderForm">
    <div class="section">
      <label for="payerName">입금자명</label>
      <input type="text" id="payerName" required />
    </div>
    <div class="section">
      <label><input type="checkbox" name="menu" value="불고기덮밥" /> 불고기덮밥</label>
      <label><input type="checkbox" name="menu" value="제육덮밥" /> 제육덮밥</label>
      <label><input type="checkbox" name="menu" value="콜라" /> 콜라</label>
    </div>
    <button type="submit">주문하기</button>
  </form>
</body>
</html>